import std.*;

public protocol PinProtocal{
    //on: {pin: int }
    //off: {pin: int }
    on: {int pin;}
    off: {int pin;}
}

void playLED(shared chan<PinProtocal>.write c, int pin){
    for (int i=0; i<5; i++){
        //c.write(new ArduinoLED{on: pin = pin});
        c.write(new PinProtocal{on: pin = pin});
        jl_sleep(1000);
        //c.write(new ArduinoLED{off: pin = pin});
        c.write(new PinProtocal{off: pin = pin});
        jl_sleep(1000);
    }
}

void RaspberryPi(chan<PinProtocal>.read in){
    while (true){
        //ArduinoLED v = in.read();
        PinProtocal v = in.read();
        switch(v){
            case on: 
                set_high_pi3(v.pin);
                break;
            case off: 
                set_low_pi3(v.pin);
                break;
        }
    }
}

public void main(string[] args){
    pi3_println("******");
    shared write chan<PinProtocal> c;
    par{
        playLED(c.write, 21);
        //playLED(c.write, 20);
        RaspberryPi(c.read);
    }
}

